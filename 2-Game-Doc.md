# پیش زمینه
چند وقت پیش در کلونی‌آباد زمین لرزه‌ای رخ داد که باعث به وجود آمدن خرابی‌های بسیاری شد. جنگجوها (عقرب‌ها) و کارگر‌ها (مورچه‌ها) از کلونی‌آباد مجبور به نقل مکان می‌شوند. در مسیر، آبادی دیگری می‌بینند (جنگ‌کار آباد). آن‌ها تصمیم می‌گیرند که در آن‌جا سکنی گزینند. اما ساکنین جنگ‌کار آباد که در جنگ نیز بسیار مهارت داشتند، به این راحتی آبادی خود را با دیگران شریک نمی‌شوند. و این زمینه‌ی آغاز جنگ را فراهم می‌کند ...

# خلاصه بازی
بازی در چند نوبت (turn) انجام می‌شود. در هر نوبت، نیروه‌ها (جلوتر توضیح داده می‌شوند) می‌توانند در زمین جابه‌جا شوند، منابع را بردارند یا به دشمن حمله کنند.
دو کلونی در یک زمین مستطیلی با هم مبارزه می‌کنند و هدف هر یک نابودی پایگاه حریف با جمع‌آوری منابع و ایجاد نیروهای جدید می‌باشد. اندازه نقشه در یک بازی ثابت است. همچنین ضلع چپ و راست زمین و هم‌چنین ضلع بالا و پایین آن به یکدیگر متصل هستند.

# یونیت‌ها
## خانه‌های زمین
* خانه‌ها، در مرحله‌ی دوم بازی، پنج حالت دارند. بعضی از خانه های زمین دیوار هستند (برای مثال خانه‌های میانی تصویر) و مورچه‌ها و عقرب‌ها نمی‌توانند در آن خانه‌ها قرار گیرند.
* هر بازیکن هم دارای یک پایگاه است که در یک نقطه مشخص زمین است و حرکت نمی‌کند. (قرار گرفتن مورچه‌ها و عقرب‌ها در پایگاه بلامانع است).  
* باقی خانه‌های زمین، خانه‌های خالی هستند که نیرو‌ها می‌توانند در آن‌ها قرار بگیرند (قرار گرفتن چند مورچه و عقرب در یک خانه بلامانع است).  
   
![cells](https://github.com/SharifAIChallenge/AIC21-Doc/blob/master/images/Cells.png?raw=true)
  
در مرحله‌ی دوم، بعضی از خانه‌ها هستند که در ابتدا خالی‌اند و سپس منبعی در آن‌ها ظاهر می‌شود. تا قبل از ظاهر شدن منبع، برای کلاینت‌ها قابل مشاهده نیست.
  
خانه‌های خالی در مرحله‌ی دوم، سه حالت دارند. بعضی از خانه‌های خالی، trap (تله) هستند. به این صورت که زمانی که مورچه‌ای که ریسورس در دست دارد روی یکی از این خانه‌ها برود، تمامی ریسورس‌هایش را از دست می‌دهد.
بعضی دیگر از خانه‌های خالی، Swamp (باتلاق) هستند. باتلاق به این صورت است که اگر نیرویی روی آن‌ها برود، به اندازه‌ی swamp_turns نمی‌تواند حرکت کند.
باقی‌ خانه‌ها نیز کاملا خالی هستند. 

در تصویر زیر، خانه‌ی بالایی یک خانه‌ی خالی‌ست. پایین سمت راست یک swamp و پایین سمت چپ یک trap.  
![cells2](https://raw.githubusercontent.com/SharifAIChallenge/AIC21-Doc/main/images/trap_swamp.jpg)

* trapها روی عقرب‌ها تاثیری ندارند.
* اثر swamp روی تمامی نیروهاست.
* نیروها می‌توانند روی trapها و swampها حرکت کنند، اما ریسورس‌ای روی این منابع قرار نمی‌گیرد.
* اگر نیرویی روی یک trap یا swamp بمیرد، ریسورس آن روی یکی از خانه‌های اطراف به صورت رندم قرار می‌گیرد.

### اتصال طرفین نقشه
نقشه‌ی بازی، به صورت آینه‌ای‌ست. یعنی سمت راست آن به چپ، و بالای آن به پایین نقشه متصل است. به طور مثال، اگر نیرویی در لبه‌ی پایین نقشه باشد (یعنی در پایین‌ترین ردیف نقشه) و یک خانه‌ی دیگر به سمت پایین حرکت کند، به لبه‌ی بالای نقشه منتقل می‌شود.  
نکته‌ی حائز اهمیت، این است که نیروهایی که نزدیک به یکی از اضلاع نقشه هستند، با توجه به محدودیت اندازه‌ی دید نیرو، می‌توانند طرف دیگر نقشه را نیز را ببینند. در مثالی که قبل‌تر ذکر شد، نیروی پایین نقشه، می‌تواند خانه‌های بالای نقشه را نیز مشاهده کند.  
این دسترسی فقط محدود به دیدن نمی‌شود و عقرب‌ها (نیروهای جنگ‌جو)، می‌توانند به نیروهای حریف که در طرف دیگر نقشه هستند و در زاویه‌ی دیدشان قرار دارند ضربه وارد کنند. به طور مثال، اگر عقربی کنار ضلع سمت راست نقشه باشد و نیرویی از حریف در کنار ضلع چپ نقشه قرار داشته باشد، عقرب می‌تواند به آن نیرو ضربه وارد کند.  
این مسئله برای پایگاه‌ها نیز برقرار است.  

## منابع زمین
* دو نوع منبع (نان و علف) در زمین موجود است. منابع در خانه‌های خالی قرار دارند. پس از برداشت هر مورچه‌ی کارگر ۱۰ واحد از آن منبع کاهش پیدا می‌کند؛ هرگز در یک خانه دو نوع منبع قرار نمی‌گیرد (از آن جا که منبع در خانه‌ی خالی است، قرار گرفتن و عبور نیروها از آن خانه منبع بلامانع است).
  
![resources](https://github.com/SharifAIChallenge/AIC21-Doc/blob/master/images/Resources.png?raw=true)
  
## نیروها
### مورچه‌ی کارگر
  * **جان اولیه:** در هنگام تولید، هر مورچه کارگر جانی برابر با health_worker دارد.
  * **طریقه برداشت منابع:** هر مورچه کارگر در نوبتش در صورتی که به یک خانه خالی حاوی منبع برسد، ۱۰ واحد از آن منبع را به صورت اتوماتیک برمی‌دارد و در ادامه تا زمانی که یک منبع را حمل می‌کند نمی‌تواند منبع جدیدی بردارد. با رسیدن مورچه کارگر حامل منبع به پایگاه خودی، منابع را تحویل می‌دهد.
  * در صورتی که چند مورچه کارگر همزمان به یک خانه حاوی منبع برسند و منبع در آن خانه به مقداری نباشد که به همه ی آن مورچه ها برسد، به شکل تصادفی منابع آن خانه به مورچه‌ها می‌رسد. 
  * نوار قرمز رنگ کنار مورچه‌ها نشان‌دهنده‌ی سلامتی مورچه می‌باشد.
  * عدد روی آن‌ها نیز بیان‌گر  id آن مورچه است.
  
![ants](https://github.com/SharifAIChallenge/AIC21-Doc/blob/master/images/Ants.png?raw=true)
  
### عقرب سرباز
  * **جان اولیه:** سلامتی عقرب‌ها در زمان به وجود آمدن، به اندازه‌ی health_attacker می‌باشد.
  *  **طریقه حمله:** عقرب سرباز می‌تواند به همه‌ی نیروهای و پایگاه حریف در شعاع attack_distance (منهتنی) از خودش حمله کند (همان دید نیرو که در ادامه توضیح داده می‌شود).
  * عقرب سرباز در هر نوبت حداکثر ۱ حمله خواهد داشت که با اولویت حمله به پایگاه حریف، سپس حمله به سربازها و بعد حمله به مورچه‌هاست. میان نیروهای هم اولویت، در مرحله‌ی دوم، دمیج به نیروی با کم‌ترین سلامتی وارد می‌شود. حمله به صورت اتوماتیک است و فرمان حمله توسط عقرب داده نمی‌شود.
  * نوار قرمز رنگ کنار عقرب‌ها نشان‌دهنده‌ی سلامتی عقرب سرباز است.
  * عدد روی عقرب سرباز بیان‌گر id سرباز می‌باشد.  
  
![scorpions](https://github.com/SharifAIChallenge/AIC21-Doc/blob/master/images/Scorpions.png?raw=true)


### مشخصات
هر نیرو در هر لحظه یک مکان (x, y) دارد. همچنین هر نیرو مقدار مشخصی جان دارد که در زمانی که تولید می‌شود برابر مقدار اولیه است.

### اکشن‌ها
هر نیرو می تواند در هر نوبت خود به یکی از خانه های بالا، پایین، چپ یا راست خود (به شرط اینکه دیوار نباشد) برود یا در جای خود باقی بماند. هر نیرو در هر نوبت می تواند یک پیام با طول محدود و ارزش مشخص برای قرار گرفتن در چت باکس دور بعد ارسال کند (پیام‌ها در بخش [ارتباط نیروها](https://aichallenge.ir/dashboard/doc/Game%20Doc#%D8%A7%D8%B1%D8%AA%D8%A8%D8%A7%D8%B7-%D9%85%D9%88%D8%B1%DA%86%D9%87%E2%80%8C%D9%87%D8%A7) توضیح داده شده‌اند).


### ساخت نیرو
با آوردن منابع به پایگاه، هر زمان که سطح منبع نان از حد generate_worker بالاتر رفت یک مورچه (کارگر) و هر زمان که حد منبع علف از generate_attacker بالاتر رفت یک عقرب (سرباز) تولید می‌شود. مکان اولیه مورچه یا عقرب تولید شده مکان پایگاه است و زمان تولید آن دور بعد از رسیدن منبع مشخص به حد نصاب است.

### حمله
* هر حمله یک عقرب (سرباز) به یک نیرو یا پایگاه حریف، به اندازه‌ی attacker_damage از جان نیرو یا پایگاه کم می‌کند؛ همچنین در هر نوبت ابتدا حمله و سپس حرکت انجام می شود.
* در اثر مردن یک نیرو، منبعی با ارزش rate_death_resource از نوع آن نیرو در آن خانه ایجاد می‌شود. مثلا اگر این پارامتر ۲/۳ باشد، منبعی با ارزش ۲/۳ مقدار generate آن نوع نیرو در آن مکان قرار می‌گیرد. ضمنا در صورتی که در اثر حمله، نیروای بمیرد، اگر آن نیرو، کارگر (مورچه) بوده و منبعی حمل می‌کرده آن منبع در مجاورت محل مردن قرار می‌گیرد.
* همچنین هر پایگاه در صورتی که نیروی رقیب در محدود حمله آن قرار بگیرد با مقدار آسیب مشخص و به اولویت تعیین‌شده به نیرو های رقیب که به‌ترتیب سرباز و کارگر است؛  حمله می‌کند.
* هر سرباز همانطور که در بخش نیروها اشاره شد، در هر نوبت حداکثر ۱ حمله خواهد داشت که با اولویت حمله به پایگاه حریف، سپس حمله به سربازها و بعد حمله به کارگر‌هاست. میان نیروهای هم اولویت، در مرحله‌ی دوم، دمیج به نیروی با کم‌ترین سلامتی وارد می‌شود. بین نیروهای با سلامتی یکسان، ضربه به صورت تصادفی وارد می‌شود. حمله به صورت اتوماتیک است و فرمان حمله توسط عقرب داده نمی‌شود
* در مرحله‌ی دوم، دمیج حمله‌ی پایگاه به تمامی نیروهای داخل یک cell وارد می‌شود.

ضمنا چون نباید هیچ دو منبعی در یک خانه باشند، اگر خانه مردن مورچه خود حاوی منبع باشد منبع در اثر مردن را در یکی از خانه‌های مجاوری که خالی است قرار می‌دهیم (نزدیک‌ترین خانه خالی از نظر منهتنی و به صورت تصادفی در حالت چند انتخاب داشتن).
  
### فاصله منهتنی
فاصله‌ی منهتنی یا [manhattan distance](https://en.wiktionary.org/wiki/Manhattan_distance) به مجموع تعداد اختلاف ردیف‌ها و ستون‌های مبدا و مقصد می‌گویند.

# اطلاعات نقشه
هر نیرو تا فاصله منهتنی مشخصی از خانه‌ای که در آن قرار دارد (view_distance) را مشاهده می‌کند (حتی پشت دیوار هم دیده می‌شود). نیرو نوع خانه، مقدار منابع موجود در آن (و نوع آن‌)، شماره دوری که بازی در آن جریان دارد، نیرو‌ها (نوع و تیم) را در محدوده ای از نقشه که مشاهده می‌کند می‌بیند.  
هم‌چنین، از آن‌جایی که بالا و پایین و همینطور راست و چپ نقشه به هم متصل‌اند، به طور مثال نیرویی که پایین نقشه قرار دارد، مقداری از بالای نقشه را نیز می‌بیند. همینطور برای راست و چپ نقشه.  
در دیدن زمین تفاوتی بین دیدن پشت و جلوی دیوار وجود ندارد. همچنین هر نبرو از مکان فعلی، منبعی که حمل می‌کند (اگر کارگر است) اندازه نقشه و مقدار جان فعلی خود اطلاع دارد. به جز این موارد نیرو از باقی اطلاعات آگاهی ندارد.

# ارتباط نیرو‌ها
هر کدام از نیروها، یک پراسس جدا هستند. یعنی کد کلاینت شما، به ازای هر نیرو، یک بار اجرا می‌شود. در نتیجه نیروها هیچ حافظه‌ی مشترکی با هم ندارند. برای انتقال اطلاعات دریافتی هر کدام از نیروها از نقشه و یا شرایط بازی به سایر نیروها، چت‌باکسی وجود دارد که نیروها می‌توانند اطلاعات خود را با محدودیت‌هایی که در ادامه آمده، برای سرور ارسال کنند تا پیام‌های با اولویت بالاتر (اولویت پیام‌ها نیز جلوتر توضیح داده شده‌است) در چت‌باکس نمایش داده شوند.
هر نیرو می تواند در هر نوبت یک پیام با طول محدود و ارزش مشخص ارسال کند. در هر نوبت تعداد مشخصی از پیام‌ها (chat_limit) با بیش‌ترین ارزش در چت قرار می‌گیرند. اگر ارزش چند پیام که شانس حضور در چت را داشتند برابر بود به صورت تصادفی از بین آن‌ها انتخاب می‌شود. هر پیام در چت‌باکس متشکل از تعدادی کاراکتر ASCII و (chat_message_length) یک عدد است که برابر دوری است که پیام در آن ارسال شده (ارزش پیام‌ها در چت‌باکس دیده نمی‌شود). همه ی نیروها به همه‌ی چت‌باکس دسترسی دارند و هیچ پیامی از چت‌باکس حذف نمی‌شود. (حتی پس از ساخته شدن نیرو دسترسی به پیام‌های گذشته ممکن است) ضمنا چت‌باکس دو تیم از هم جداست و دسترسی به چت‌باکس تیم مقابل امکان‌پذیر نیست.  
توجه کنید که تمامی پیام‌های کلاینت‌ها برای سرور روی نمایشگر گرافیکی نشان داده می‌شود، اما فقط پیام‌های مجاز که توسط سرور انتخاب می‌شوند در دسترس کلاینت‌ها قرار می‌گیرد. 
پیام‌ها باید با کدینگ [uft-8](https://en.wikipedia.org/wiki/UTF-8) باشند.

# شرط برد
هدف بازی نابود کردن پایگاه حریف است. هر بار که پایگاه توسط عقرب (سرباز) مورد حمله قرار می گیرد به اندازه‌ی attacker_damage از جان خود را از دست می‌دهد. با رسیدن به محدودیت تعداد دور بازی (max_turns) اگر هیچ پایگاهی نابود نشده بود، موارد زیر به ترتیب بررسی می‌شوند، در هر کدام که تیمی از حریف برتری داشت، برنده مشخص می‌شود.  
**میزان سلامتی پایگاه، تعداد کل نیروهای زنده، تعداد کل نیروهای ساخته شده در طول بازی، تعداد عقرب‌های ساخته شده، میزان ریسورس ۲ (گندم)، میزان ریسورس ۱ (علف)**

# متغیرها
در جدول زیر، لیست متغیرها به همراه توضیح و مقدار آن‌ها آمده است.
توجه کنید که متغیر‌ها، در همه‌ی بازی‌ها ثابت هستند و هر گونه تغییر در آن‌ها اطلاع‌رسانی می‌شود.

| **Variable** | **Value** |  **Description**  |
|:-------------|:------|:--------------------------|
|swamp_turns   | 3     | تعداد نوبت‌هایی که نیروها روی swamp گیر می‌کنند. (مرحله‌ی دوم) |
|ants_view     | 4     |  میزان دید منهتنی نیروها         |
|ants_reg_rate | 0.8   |  مقدار منبع به جا مانده بعد از مرگ نیرو|
|base_range    | 6     |  میزان دید منهتنی پایگاه           |
|base_damage   | 3     |  میزان آسیب حمله پایگاه            |
|base_health   | 20    |  میزان سلامتی اولیه پایگاه          |
|max_com_per_turn | 5    | حداکثر تعداد پیام در هر دور      |
|max_com_length   | 32 (Byte) |  حداکثر طول پیام‌ها         |
|max_turn         | 200  |  حداکثر تعداد دور بازی           |
|worker_health    | 6    |  میزان سلامتی اولیه مورچه (کارگر)   |
|attacker_health  | 8    |  میزان سلامت اولیه عقرب (سرباز)   |
|attacker_range   | 4    |  برد حمله عقرب            |
|attacker_damage  | 2    |  میزان آسیب حمله عقرب     |
|worker_price     | 10   |  هزینه تولید مورچه        |
|ant_max_rec_amount | 10 |  میزان باری که مورچه می‌تواند حمل کند   |
|attacker_price   | 15   |  هزینه تولید عقرب         |
|start_worker     | 4    |  تعداد مورچه‌ها در شروع   |
|start_attacker   | 0    |  تعداد عقرب‌ها در شروع   |
|max_turn_time    | 1    |  زمان هر نوبت                    |
|map_size         | 35   |  حداکثر طول هر ضلع نقشه                  |
|map_wall_perc    | 20%  |  درصدی از مپ که دیوارها هستند    |
|min_base_dist    | 10   |  حداقل فاصله‌ی دو پایگاه         |
|work_rec_amount  | 800   | حداکثر مقدار گندم موجود در نقشه        |
|attack_rec_amount| 800   |  حداکثر مقدار علف موجود در نقشه         |
|mirror_effect    | yes  | [اتصال بالا و پایین و چپ راست زمین](https://github.com/SharifAIChallenge/AIC21-Doc/blob/main/2-Game-Doc.md#%D8%A7%D8%AA%D8%B5%D8%A7%D9%84-%D8%B7%D8%B1%D9%81%DB%8C%D9%86-%D9%86%D9%82%D8%B4%D9%87) |
